# 详解XSS与CSRF

## XSS

**XSS** 即 **跨站脚本攻击（Cross-Site Scripting）**

攻击者在网站上注入恶意的客户端代码，通过恶意脚本对客户端网页进行篡改，从而在用户浏览网页时，对用户浏览器进行控制或者获取用户隐私数据。

XSS攻击可以分为3类：反射型、存储型、基于DOM型。

**1、反射型（非持久型）：**

发出请求时，XSS代码出现在url中，作为输入提交到服务器端，服务器端解析后响应，XSS代码随响应内容一起传回给浏览器，最后浏览器解析执行XSS代码。这个过程就像一次反射，所以叫反射型XSS。

**2、存储型（持久型）**：

存储型和反射型的差别就在于，具有攻击性的脚本被保存到了服务器端（数据库、内存、文件系统）并且可以被普通用户完整的从服务端取得并执行，从而获得了在网络上的传播的能力。

**3、DOM型**：

基于 DOM 的 XSS 攻击是指通过恶意脚本修改页面的 DOM 结构，将攻击脚本写在 URL 中，诱导用户点击该 URL，如果 URL 被解析，那么攻击脚本就会被运行，和前两者 XSS 攻击区别是：取出和执行恶意代码由浏览器端完成，不经过服务端，属于前端 JavaScript 自身的安全漏洞，而其他两种 XSS 都属于服务端的安全漏洞主要在于 DOM 型攻击。

**XSS防御措施：**

**1、输入过滤：**

避免XSS的方法之一主要是将用户输入的内容进行过滤。对所有用户提交的内容进行可靠的输入验证，包括对URL、查询关键字、POST数据等，仅接受指定长度范围、采用适当格式、采用所预期的字符的内容提交，对其他的一律过滤（客户端和服务端都要）

**2、输出转义：**

通过对不同类型的文本和数据做对应的转义和很好的防止大部分的XSS攻击。

对一些特殊的字符，例如"`& < > " ' /`"进行转义

**3、使用HttpOnly：**

HttpOnly 是 Cookie 的一个属性，在设置Cookie的时候对Cookie设置该属性，就可以防止Cookie被js脚本获取。只能通过Http传输和访问。

我们需要明确的是HttpOnly本质上并不是防止XSS攻击的，主要是起到缓解的作用，在恶意脚本执行之后，是无法获取到对应的Cookie，防止来下一步攻击的进行和用户数据的进一步泄漏。

**XSS攻击有哪些？**

- 屏幕截图
- 钓鱼攻击
- 蠕虫攻击
- 键盘攻击
- 获取管理员IP

## CSRF

**CSRF** 即 **跨站请求伪造（Cross-site request forgery）**

CSRF简单地说就是指攻击者盗用了你的身份，以你的名义发送恶意请求。

![image-20220811211220827](C:%5CUsers%5Cluowanting%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20220811211220827.png)

**CSRF防御措施：**

**1、cookie 设置 SameSite**

可以对 Cookie 设置 SameSite 属性。该属性设置 Cookie 不随着跨域请求发送，该属性可以很大程度减少 CSRF 的攻击，但是该属性目前并不是所有浏览器都兼容。

**2、 验证 Referer**

对于需要防范 CSRF 的请求，我们可以通过验证 Referer 来判断该请求是否为第三方网站发起的。
在后台接收到请求的时候,可以通过请求头中的Referer请求头来判断请求来源

**3、Token**

服务端生成一个Token，然后放在页面中，页面提交请求的时候，带上这个Token。服务端把Token从Session中拿出，与请求中的Token进行比对验证。

**4、验证码**

由于 CSRF 攻击伪造请求不会经过受攻击的网站，所以我们可以在网站加入验证码，这样必须通过验证码之后才能进行请求，有效的遏制了 CSRF 请求。 但是，这种方式不是万能的，并不是每个请求都加验证码，那样用户体验会非常不好，只能在部分请求添加，作为一种辅助的防御手段。